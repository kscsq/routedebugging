package com.example.demo;

import arina.maplab.definitions.MapModel;
import arina.maplab.definitions.mapforce.definitions.MfdModel;
import arina.maplab.processors.MapProcessor;
import arina.maplab.value.IMapValue;
import org.apache.camel.CamelContext;
import org.apache.camel.Exchange;
import org.apache.camel.ProducerTemplate;
import org.apache.camel.impl.DefaultExchange;
import org.junit.jupiter.api.Test;
import org.junit.runner.RunWith;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.boot.test.context.SpringBootTest;
import org.springframework.test.context.junit4.SpringRunner;

import java.util.ArrayList;
import java.util.List;
import java.util.Map;

@SpringBootTest(classes = DemoApplication.class)
@RunWith(SpringRunner.class)
class DemoApplicationTests {

    @Autowired
    public CamelContext context;

    @Test
    void contextLoads() throws Exception {

        ProducerTemplate producerTemplate = context.createProducerTemplate();
        Exchange exchange = new DefaultExchange(context);

        String body = "{\"Cards\":[{\"Created\":\"2021-01-20T13:07:30.238635Z\",\"CreatedByID\":\"3db19fa0-228a-497f-873a-0250bf0a4ccb\",\"CreatedByName\":\"Admin Аdминь\",\"Files\":[{\".flags\":0,\".state\":0,\".versionsLoaded\":false,\"Card\":{\"Created\":\"2021-01-26T11:26:43.278763Z\",\"CreatedByID\":\"3db19fa0-228a-497f-873a-0250bf0a4ccb\",\"CreatedByName\":\"Admin Аdминь\",\"Flags\":0,\"ID\":\"f58ff27b-caca-4b0a-a535-e282318ee01e\",\"Info\":null,\"Modified\":\"2021-01-26T11:26:43.278763Z\",\"ModifiedByID\":\"3db19fa0-228a-497f-873a-0250bf0a4ccb\",\"ModifiedByName\":\"Admin Аdминь\",\"Permissions\":{\"CardPermissions\":174762,\"FilePermissions\":null,\"Sections\":null},\"Sections\":{\"FileSignatures\":{\".table\":1,\"Rows\":null}},\"TypeCaption\":\"$CardTypes_TypesNames_File\",\"TypeID\":\"ab387c69-fd62-0655-bbc3-b879e433a143\",\"TypeName\":\"File\",\"Version\":1},\"CategoryCaption\":null,\"CategoryID\":null,\"ExternalSource\":null,\"Hash\":null,\"Info\":null,\"IsVirtual\":false,\"Name\":\"s1200.jpg\",\"NewVersionTags\":null,\"Options\":null,\"OriginalFileID\":null,\"OriginalVersionRowID\":null,\"RequestInfo\":null,\"RowID\":\"f58ff27b-caca-4b0a-a535-e282318ee01e\",\"SectionRows\":{\"FileSignatures\":{\"Comment\":null,\"Company\":null,\"Data\":null,\"EventID\":null,\"IssuerName\":null,\"RowID\":\"00000000-0000-0000-0000-000000000000\",\"SerialNumber\":null,\"Signed\":null,\"SubjectName\":null,\"UserID\":null,\"UserName\":null,\"VersionRowID\":null}},\"Size\":143752,\"StoreSource\":1,\"TaskID\":null,\"TypeCaption\":\"$CardTypes_TypesNames_File\",\"TypeID\":\"ab387c69-fd62-0655-bbc3-b879e433a143\",\"TypeName\":\"File\",\"VersionNumber\":1,\"VersionRowID\":\"e095fa74-bc61-4fd9-b01e-aae7c7502198\",\"Versions\":[{\"Created\":\"2021-01-26T11:26:43.278763Z\",\"CreatedByID\":\"3db19fa0-228a-497f-873a-0250bf0a4ccb\",\"CreatedByName\":\"Admin Аdминь\",\"ErrorDate\":null,\"ErrorMessage\":null,\"Hash\":null,\"LinkID\":null,\"Name\":\"s1200.jpg\",\"Number\":1,\"Options\":null,\"RequestInfo\":null,\"RowID\":\"e095fa74-bc61-4fd9-b01e-aae7c7502198\",\"Size\":143752,\"Source\":8,\"State\":1,\"Tags\":null}],\"FileStoreKey\":[\"e5db52f7-9719-4a60-a092-4c7de36dbfe3\"]},{\".flags\":0,\".state\":0,\".versionsLoaded\":false,\"Card\":{\"Created\":\"2021-01-20T13:07:30.238635Z\",\"CreatedByID\":\"3db19fa0-228a-497f-873a-0250bf0a4ccb\",\"CreatedByName\":\"Admin Аdминь\",\"Flags\":0,\"ID\":\"05b23e5e-0c07-417e-9b74-353a092d933d\",\"Info\":null,\"Modified\":\"2021-01-26T11:25:33.903581Z\",\"ModifiedByID\":\"3db19fa0-228a-497f-873a-0250bf0a4ccb\",\"ModifiedByName\":\"Admin Аdминь\",\"Permissions\":{\"CardPermissions\":174762,\"FilePermissions\":null,\"Sections\":null},\"Sections\":{\"FileSignatures\":{\".table\":1,\"Rows\":null}},\"TypeCaption\":\"$CardTypes_TypesNames_File\",\"TypeID\":\"ab387c69-fd62-0655-bbc3-b879e433a143\",\"TypeName\":\"File\",\"Version\":2},\"CategoryCaption\":\"Скан-образ\",\"CategoryID\":\"4875ac5b-da0f-4cbd-aa6e-3c4834d1ff1a\",\"ExternalSource\":null,\"Hash\":null,\"Info\":null,\"IsVirtual\":false,\"Name\":\"Тестовый 10 листов.pdf\",\"NewVersionTags\":null,\"Options\":null,\"OriginalFileID\":null,\"OriginalVersionRowID\":null,\"RequestInfo\":null,\"RowID\":\"05b23e5e-0c07-417e-9b74-353a092d933d\",\"SectionRows\":{\"FileSignatures\":{\"Comment\":null,\"Company\":null,\"Data\":null,\"EventID\":null,\"IssuerName\":null,\"RowID\":\"00000000-0000-0000-0000-000000000000\",\"SerialNumber\":null,\"Signed\":null,\"SubjectName\":null,\"UserID\":null,\"UserName\":null,\"VersionRowID\":null}},\"Size\":274947,\"StoreSource\":1,\"TaskID\":null,\"TypeCaption\":\"$CardTypes_TypesNames_File\",\"TypeID\":\"ab387c69-fd62-0655-bbc3-b879e433a143\",\"TypeName\":\"File\",\"VersionNumber\":2,\"VersionRowID\":\"ed121340-3d18-4c79-856b-fc9de68c71c9\",\"Versions\":[{\"Created\":\"2021-01-26T11:25:33.903581Z\",\"CreatedByID\":\"3db19fa0-228a-497f-873a-0250bf0a4ccb\",\"CreatedByName\":\"Admin Аdминь\",\"ErrorDate\":null,\"ErrorMessage\":null,\"Hash\":null,\"LinkID\":null,\"Name\":\"Тестовый 10 листов.pdf\",\"Number\":2,\"Options\":null,\"RequestInfo\":null,\"RowID\":\"ed121340-3d18-4c79-856b-fc9de68c71c9\",\"Size\":274947,\"Source\":8,\"State\":1,\"Tags\":null}],\"FileStoreKey\":[\"913f178d-57d2-4825-a6a4-665662510e21\"]}],\"Flags\":0,\"ID\":\"8d7f2c5d-ea68-4a8b-9040-5eb0d805983b\",\"Info\":{\".tiles\":[\"EditNumber\",\"ReplaceNumber\"],\"docTypeID\":null,\"kr_permissions_calculated\":true,\"KrToken\":{\"CardID\":\"8d7f2c5d-ea68-4a8b-9040-5eb0d805983b\",\"CardVersion\":2,\"ExpiryDate\":\"2021-01-29T12:28:35.5968198Z\",\"Permissions\":2605118,\"Signature\":\"RLjyEjS6c6HE5+pkP87sPmE9kv5HC7sib4p0f2kvSxs=\"},\"LoadVerificationTasks\":true,\"LocalTilesInfoMark\":[],\"StagePositions\":[]},\"Modified\":\"2021-01-26T11:26:43.278763Z\",\"ModifiedByID\":\"3db19fa0-228a-497f-873a-0250bf0a4ccb\",\"ModifiedByName\":\"Admin Аdминь\",\"Permissions\":{\"CardPermissions\":92501,\"FilePermissions\":{\"05b23e5e-0c07-417e-9b74-353a092d933d\":5121,\"f58ff27b-caca-4b0a-a535-e282318ee01e\":5121},\"Sections\":{\"KrPerformersVirtual_Synthetic\":{\"FieldPermissions\":null,\"Rows\":{},\"SectionPermissions\":21},\"KrStagesVirtual\":{\"FieldPermissions\":null,\"Rows\":{},\"SectionPermissions\":21},\"RgsPackage\":{\"FieldPermissions\":{\"PlannedOn\":2},\"SectionPermissions\":0}}},\"Sections\":{\"DocumentCommonInfo\":{\"Fields\":{\"Barcode\":null,\"BranchBkName\":\"КОРНЕВОЕ ПОДРАЗДЕЛЕНИЕ  (БК ID 11615)\",\"BranchID\":\"64378ec5-75c9-4962-b39e-0cce57fe0b8e\",\"BranchIndex\":\"\",\"BranchSkkCode\":\"17750010\",\"CardTypeID\":\"eb60f9fd-9073-4362-86aa-4874a822b7e0\",\"CreationDate\":\"2021-01-20T13:05:31.465Z\",\"DocDate\":\"2021-01-20T00:00:00Z\",\"FullNumber\":\"17750010-3123083370-200121\",\"InitiatorID\":\"3db19fa0-228a-497f-873a-0250bf0a4ccb\",\"InitiatorName\":\"Admin Аdминь\",\"InitiatorPosition\":\"Руководитель группы\"}},\"KrActiveTasksVirtual\":{\".table\":1,\"Rows\":[]},\"KrAdditionalApprovalInfoUsersCardVirtual_Synthetic\":{\".table\":1,\"Rows\":null},\"KrAdditionalApprovalUsersCardVirtual_Synthetic\":{\".table\":1,\"Rows\":null},\"KrApprovalCommonInfoVirtual\":{\"Fields\":{\"ApprovedBy\":null,\"AuthorComment\":null,\"AuthorID\":null,\"AuthorName\":null,\"CurrentApprovalStageRowID\":null,\"DisapprovedBy\":null,\"MainCardID\":\"8d7f2c5d-ea68-4a8b-9040-5eb0d805983b\",\"StateChangedDateTimeUTC\":\"2021-01-20T13:07:30.377943Z\",\"StateID\":114,\"StateName\":\"$Rgs_Enums_KrStates_NotProcessed\"}},\"KrApprovalHistoryVirtual\":{\".table\":1,\"Rows\":[]},\"KrForkNestedProcessesSettingsVirtual_Synthetic\":{\".table\":1,\"Rows\":null},\"KrForkSecondaryProcessesSettingsVirtual_Synthetic\":{\".table\":1,\"Rows\":null},\"KrPerformersVirtual_Synthetic\":{\".table\":1,\"Rows\":null},\"KrStagesVirtual\":{\".table\":1,\"Rows\":[]},\"KrUniversalTaskOptionsSettingsVirtual_Synthetic\":{\".table\":1,\"Rows\":null},\"RgsCommonVirtual\":{\"Fields\":{\"StateID\":114,\"StateName\":\"$Rgs_Enums_KrStates_NotProcessed\"}},\"RgsDocumentStorageInfoVirtual\":{\"Fields\":{\"RecyclingActFullNumber\":null,\"RecyclingActID\":null}},\"RgsIncomingRefDocs\":{\".table\":1,\"Rows\":null},\"RgsOutgoingRefDocs\":{\".table\":1,\"Rows\":null},\"RgsPackage\":{\"Fields\":{\"AgentCode\":\"3123083370\",\"AgentID\":\"00263cb6-89a4-4240-882d-cecdcf93db44\",\"AgentInnIndividualEntrepreneur\":\"000000928212\",\"AgentName\":\"00263cb68\",\"AlternativeVerificationGroupID\":null,\"AlternativeVerificationGroupName\":null,\"AttachedFileTypeID\":0,\"AttachedFileTypeName\":\"$Rgs_Enums_AttachedFileTypes_NotAttached\",\"BoxID\":null,\"BoxNumber\":null,\"CommentForRobot\":null,\"ContractCount\":2,\"CreationPlaceBkName\":\"КОРНЕВОЕ ПОДРАЗДЕЛЕНИЕ  (БК ID 11615)\",\"CreationPlaceID\":\"64378ec5-75c9-4962-b39e-0cce57fe0b8e\",\"CreationPlaceSkkCode\":\"17750010\",\"CurrentVerificationStageHistoryBeginOn\":null,\"CurrentVerificationStageHistoryRowID\":null,\"DocumentCategoryID\":\"862c404a-13ca-4e8d-8e7e-10f40930a790\",\"DocumentCategoryName\":\"Страховые документы\",\"DocumentTypeID\":\"d281259c-d3e0-4625-aed5-a438074d7fde\",\"DocumentTypeName\":\"Отчет агента\",\"EkisID\":null,\"GrossPremium\":1000.0,\"HasRescan\":false,\"IsNeedToChangeStage\":false,\"IsNetting\":null,\"IsNotForArchive\":false,\"IsPersonal\":false,\"LastStateID\":null,\"LastStateName\":null,\"PackageCategoryID\":\"39e5066d-277c-4c7a-ba45-43fdba128bf5\",\"PackageCategoryName\":\"Агентский\",\"PackageNumber\":\"17750010_2021.01.20_16-05-31\",\"PackagePriorityID\":3,\"PackagePriorityName\":\"$Rgs_Enums_StagePriority_Normal\",\"PageCount\":15,\"PlannedOn\":null,\"PlannedRecyclingOn\":null,\"PreviousVerificationStageHistoryRowID\":null,\"ProblemID\":null,\"ProblemName\":null,\"ReassignedID\":null,\"RecipientAgentCode\":null,\"RecipientAgentID\":null,\"RecipientAgentName\":null,\"RecipientCodeBkName\":null,\"RecipientCodeID\":null,\"RecipientCodeSkkCode\":null,\"RecycleOn\":null,\"RecyclingActFullNumber\":null,\"RecyclingActID\":null,\"ReturnPremium\":null,\"SADcode\":null,\"SalesChannelCode\":\"120\",\"SalesChannelID\":\"8baac919-0e05-456d-82ea-e75e92aa8f72\",\"SalesChannelName\":\"Агентские продажи\",\"ScanComment\":null,\"ScanningOn\":\"2021-01-20T00:00:00Z\",\"ScanQualityID\":null,\"ScanQualityName\":null,\"StorageComment\":null,\"StorageDuration\":5,\"StoragePlaceID\":null,\"StoragePlaceName\":null,\"StorageTypeID\":null,\"StorageTypeName\":null,\"TransferListFullNumber\":null,\"TransferListID\":null,\"TransferOn\":null,\"TransferRegistryFullNumber\":null,\"TransferRegistryID\":null,\"VerificationDate\":null,\"VerificationGroupID\":null,\"VerificationGroupName\":null,\"VerificationStageID\":null,\"VerificationStageName\":null,\"VerificationStageTypeID\":null,\"VerificationStageTypeName\":null,\"WasPostponed\":false,\"WithdrawRequestFullNumber\":null,\"WithdrawRequestID\":null}},\"RgsPackageAdditionalAgents\":{\".table\":1,\"Rows\":null},\"RgsPackageChanges\":{\".table\":1,\"Rows\":null},\"RgsPackageLinkedTasks\":{\".table\":1,\"Rows\":null},\"RgsPackageTemplateComments\":{\".table\":1,\"Rows\":null},\"RgsPackageVerificationGroupHistory\":{\".table\":1,\"Rows\":null},\"RgsPackageVerificationStageHistory\":{\".table\":1,\"Rows\":null},\"RgsPackageVirtual\":{\"Fields\":{\"Stillage\":null}},\"RgsPackageWithdrawRequestsVirtual\":{\".table\":1,\"Rows\":[]},\"RgsTempRoleStageGroupInfo\":{\".table\":1,\"Rows\":null}},\"TaskHistory\":[],\"TaskHistoryGroups\":[],\"Tasks\":[],\"TypeCaption\":\"$Rgs_CardTypes_TypesNames_InsurancePackage\",\"TypeID\":\"eb60f9fd-9073-4362-86aa-4874a822b7e0\",\"TypeName\":\"RgsInsurancePackage\",\"Version\":2,\"Link\":\"tessa://tessaclient.UAT/?Action=OpenCard&ID=8d7f2c5d-ea68-4a8b-9040-5eb0d805983b\"}]}";

        exchange.getIn().setBody(body);
        producerTemplate.send("direct:start", exchange);

    }

    @Test
    public void testArina() throws Exception {
        List<String> arrayList = new ArrayList<>();

        arrayList.add("file:src/main/resources/mfd/ekisToTessa.mfd");
        MfdModel model = new MfdModel(MapModel.load(arrayList, true));
        String body = "HW";

        MapProcessor processor = new MapProcessor(model).set("body", body);

        for (Map.Entry<String, IMapValue> item : processor.getOutputs().entrySet())
            System.out.println("key = " + item.getKey() + "\nvalue = " + item.getValue().getValue(String.class));

    }

}
